<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <title>courseadd</title>
  <!-- bootstrap style，map pluginuse -->
  <link rel="stylesheet" href="../../css/bootstrap.min.css"/>
  <link rel="stylesheet" href="../../layui/css/layui.css">

  <link rel="stylesheet" href="../../css/style.css"/>

  <link rel="stylesheet" href="../../css/theme.css"/>

  <link rel="stylesheet" href="../../css/common.css"/>
</head>
<style>
    html::after {
        position: fixed;
        top: 0;
        right: 0;
        left: 0;
        bottom: 0;
        content: '';
        display: block;
        background-attachment: fixed;
        background-size: cover;
        background-position: center;
        z-index: -1;
    }

    #swiper {
        overflow: hidden;
        margin: 0 auto;
    }

    #swiper .layui-carousel-ind li {
        width: 16px;
        height: 10px;
        border-width: 0;
        border-style: solid;
        border-color: rgba(0, 0, 0, .3);
        border-radius: 3px;
        background-color: #f7f7f7;
        box-shadow: 0 0 6px rgba(255, 0, 0, .8);
    }

    #swiper .layui-carousel-ind li.layui-this {
        width: 24px;
        height: 24px;
        border-width: 0;
        border-style: solid;
        border-color: rgba(0, 0, 0, .3);
        border-radius: 24px;
        background-color: rgba(255, 144, 18, 1);
        box-shadow: 0 0 6px rgba(255, 0, 0, .8);
    }

    button, button:focus {
        outline: none;
    }

    .data-add-container .add .layui-select-title .layui-unselect {
        padding: 0 12px;
        height: 40px;
        font-size: 14px;
        color: #333;
        border-radius: 4px;
        border-width: 1px;
        border-style: solid;
        border-color: #DCDFE6;
        background-color: #fff;
        box-shadow: 0 0 0px #FF9012;
        text-align: left;
    }

    .data-add-container .add .layui-form-item {
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .data-add-container .layui-form-pane .layui-form-item[pane] .layui-form-label {
        margin: 0;
        position: inherit;
        background: transparent;
        border: 0;
    }

    .data-add-container .add .layui-input-block {
        margin: 0;
        flex: 1;
    }

    .data-add-container .layui-form-pane .layui-form-item[pane] .layui-input-inline {
        margin: 0;
        flex: 1;
        display: flex;
    }
</style>
<body style="background: #EEEEEE; ">


<div id="app">

  <!--
  <div class="layui-carousel" id="swiper">
    <div carousel-item id="swiper-item">
      <div v-for="(item,index) in swiperList" v-bind:key="index">
        <img class="swiper-item" :src="item.img">
      </div>
    </div>
  </div> -->
  

  <div class="data-add-container"
       :style='{"padding":"20px","boxShadow":"0px 0px 0px #FF9012","margin":"30px auto","borderColor":"rgba(234, 233, 231, 1)","backgroundColor":"#fff","borderRadius":"10px","borderWidth":"1px","borderStyle":"solid"}'>

    <form class="layui-form layui-form-pane add" lay-filter="myForm">

      <div
        :style='{"padding":"10px","boxShadow":"0 00px #FF9012","margin":"0 0 10px 0","borderColor":"rgba(241, 237, 233, 1)","backgroundColor":"#fff","borderRadius":"0px","borderWidth":"0 0 1px 0","borderStyle":"solid"}'
        class="layui-form-item" pane>
        <label
          :style='{"width":"94px","padding":"0 12px 0 0","fontSize":"14px","color":"rgba(19, 175, 105, 1)","textAlign":"left"}'
          class="layui-form-label">Course Number：</label>
        <div class="layui-input-block">
          <input
            :style='{"padding":"0 12px","boxShadow":"0 0 0px #FF9012","borderColor":"#DCDFE6","backgroundColor":"#fff","color":"#333","borderRadius":"0px","textAlign":"left","borderWidth":"1px","fontSize":"14px","borderStyle":"solid","height":"40px"}'
            v-model="detail.kechengbianhao" type="text" :readonly="ro.kechengbianhao" name="kechengbianhao"
            id="kechengbianhao" autocomplete="off" class="layui-input">
        </div>
      </div>
      <div
        :style='{"padding":"10px","boxShadow":"0 00px #FF9012","margin":"0 0 10px 0","borderColor":"rgba(241, 237, 233, 1)","backgroundColor":"#fff","borderRadius":"0px","borderWidth":"0 0 1px 0","borderStyle":"solid"}'
        class="layui-form-item" pane>
        <label
          :style='{"width":"94px","padding":"0 12px 0 0","fontSize":"14px","color":"rgba(19, 175, 105, 1)","textAlign":"left"}'
          class="layui-form-label">Course name：</label>
        <div class="layui-input-block">
          <input
            :style='{"padding":"0 12px","boxShadow":"0 0 0px #FF9012","borderColor":"#DCDFE6","backgroundColor":"#fff","color":"#333","borderRadius":"0px","textAlign":"left","borderWidth":"1px","fontSize":"14px","borderStyle":"solid","height":"40px"}'
            v-model="detail.kechengmingcheng" type="text" :readonly="ro.kechengmingcheng" name="kechengmingcheng"
            id="kechengmingcheng" autocomplete="off" class="layui-input">
        </div>
      </div>
      <div
        :style='{"padding":"10px","boxShadow":"0 00px #FF9012","margin":"0 0 10px 0","borderColor":"rgba(241, 237, 233, 1)","backgroundColor":"#fff","borderRadius":"0px","borderWidth":"0 0 1px 0","borderStyle":"solid"}'
        class="layui-form-item" pane>
        <label
          :style='{"width":"94px","padding":"0 12px 0 0","fontSize":"14px","color":"rgba(19, 175, 105, 1)","textAlign":"left"}'
          class="layui-form-label">course type</label>
        <div class="layui-input-block">
          <select name="kechengleixing" id="kechengleixing" lay-filter="kechengleixing">
            <option value="">Select</option>
            <option v-for="(item,index) in kechengleixing" v-bind:key="index" :value="item">{{item}}</option>
          </select>
        </div>
      </div>
      <div
        :style='{"padding":"10px","boxShadow":"0 00px #FF9012","margin":"0 0 10px 0","borderColor":"rgba(241, 237, 233, 1)","backgroundColor":"#fff","borderRadius":"0px","borderWidth":"0 0 1px 0","borderStyle":"solid"}'
        class="layui-form-item" pane>
        <label
          :style='{"width":"94px","padding":"0 12px 0 0","fontSize":"14px","color":"rgba(19, 175, 105, 1)","textAlign":"left"}'
          class="layui-form-label"> picture：</label>
        <div class="layui-input-block">
          <div v-if="detail.tupian" style="display:inline-block;margin-right:10px;">
            <img id="tupianImg" style="width: 100px;height: 100px;border-radius: 50%;border: 2px solid #EEEEEE;"
                 :src="detail.tupian">
            <input type="hidden" :value="detail.tupian" id="tupian" name="tupian"/>
          </div>
          <button v-if="!ro.tupian"
                  :style='{"padding":"0 10px","boxShadow":"0 0 0px rgba(255,0,0,.5)","margin":"0 10px 0 0","borderColor":"#ccc","backgroundColor":"rgba(19, 175, 105, 1)","color":"#fff","borderRadius":"8px","borderWidth":"0","width":"auto","fontSize":"14px","borderStyle":"solid","height":"44px"}'
                  type="button" class="layui-btn btn-theme" id="tupianUpload">
            <i v-if="true" :style='{"color":"#fff","show":true,"fontSize":"14px"}' class="layui-icon">&#xe67c;</i>upload
            picture
          </button>
        </div>
      </div>
      <div
        :style='{"padding":"10px","boxShadow":"0 00px #FF9012","margin":"0 0 10px 0","borderColor":"rgba(241, 237, 233, 1)","backgroundColor":"#fff","borderRadius":"0px","borderWidth":"0 0 1px 0","borderStyle":"solid"}'
        class="layui-form-item" pane>
        <label
          :style='{"width":"94px","padding":"0 12px 0 0","fontSize":"14px","color":"rgba(19, 175, 105, 1)","textAlign":"left"}'
          class="layui-form-label">vedio：</label>
        <div class="layui-input-block">
          <div v-if="detail.shipin" style="margin-bottom:10px;">
            <video style="width: 100%;" :src="detail.shipin" controls="controls">
              fail
            </video>
            <input type="hidden" :value="detail.shipin" id="shipin" name="shipin"/>
          </div>
          <button
            :style='{"padding":"0 10px","boxShadow":"0 0 0px rgba(255,0,0,.5)","margin":"0 10px 0 0","borderColor":"#ccc","backgroundColor":"rgba(19, 175, 105, 1)","color":"#fff","borderRadius":"8px","borderWidth":"0","width":"auto","fontSize":"14px","borderStyle":"solid","height":"44px"}'
            type="button" class="layui-btn btn-theme" id="shipinUpload">
            <i v-if="true" :style='{"color":"#fff","show":true,"fontSize":"14px"}' class="layui-icon">&#xe67c;</i>upload
            vedio
          </button>
        </div>
      </div>
      <div
        :style='{"padding":"10px","boxShadow":"0 00px #FF9012","margin":"0 0 10px 0","borderColor":"rgba(241, 237, 233, 1)","backgroundColor":"#fff","borderRadius":"0px","borderWidth":"0 0 1px 0","borderStyle":"solid"}'
        class="layui-form-item" pane>
        <label
          :style='{"width":"94px","padding":"0 12px 0 0","fontSize":"14px","color":"rgba(19, 175, 105, 1)","textAlign":"left"}'
          class="layui-form-label">learning information：</label>
        <div class="layui-input-inline">
          <input type="hidden" :value="detail.xuexiziliao" id="xuexiziliao" name="xuexiziliao"/>
          <button
            :style='{"padding":"0 10px","boxShadow":"0 0 0px rgba(255,0,0,.5)","margin":"0 10px 0 0","borderColor":"#ccc","backgroundColor":"rgba(19, 175, 105, 1)","color":"#fff","borderRadius":"8px","borderWidth":"0","width":"auto","fontSize":"14px","borderStyle":"solid","height":"44px"}'
            type="button" class="layui-btn btn-theme" id="xuexiziliaoUpload">
            <i v-if="true" :style='{"color":"#fff","show":true,"fontSize":"14px"}' class="layui-icon">&#xe67c;</i>upload
            learning information
          </button>
          <a
            :style='{"padding":"0 10px","boxShadow":"0 0 0px #13AF69","margin":"0 10px 0 0","borderColor":"#ccc","backgroundColor":"rgba(19, 175, 105, 1)","color":"rgba(255, 255, 255, 1)","borderRadius":"8px","borderWidth":"0","width":"auto","fontSize":"14px","borderStyle":"solid","height":"44px"}'
            style="display:block;text-decoration: none;line-height: 44px;" download="learning information"
            :href="detail.xuexiziliao"><i v-if="true"
                                          :style='{"color":"rgba(255, 255, 255, 1)","show":true,"fontSize":"14px"}'
                                          class="layui-icon layui-icon-download-circle"></i> click to download learning
            information</a>
        </div>
      </div>

      <div
        :style='{"padding":"10px","boxShadow":"0 00px #FF9012","margin":"0 0 10px 0","borderColor":"rgba(241, 237, 233, 1)","backgroundColor":"#fff","borderRadius":"0px","borderWidth":"0 0 1px 0","borderStyle":"solid"}'
        class="layui-form-item" pane>
        <label
          :style='{"width":"94px","padding":"0 12px 0 0","fontSize":"14px","color":"rgba(19, 175, 105, 1)","textAlign":"left"}'
          class="layui-form-label">Course introduce：</label>
        <div class="layui-input-block">
          <textarea name="kechengjieshao" id="kechengjieshao">please input Course  introduce</textarea>
        </div>
      </div>

      <div
        :style='{"padding":"10px","boxShadow":"0 00px #FF9012","margin":"0 0 10px 0","borderColor":"rgba(241, 237, 233, 1)","backgroundColor":"#fff","borderRadius":"0px","borderWidth":"0 0 1px 0","borderStyle":"solid"}'
        class="layui-form-item">
        <div class="layui-input-block" style="text-align: right;">
          <button
            :style='{"padding":"0 10px","boxShadow":"0 0 0px#13AF69","margin":"0 10px","borderColor":"#ccc","backgroundColor":"rgba(19, 175, 105, 1)","color":"#fff","borderRadius":"8px","borderWidth":"0","width":"25%","fontSize":"14px","borderStyle":"solid","height":"44px"}'
            class="layui-btn btn-submit" lay-submit lay-filter="*">Submit
          </button>
          <button
            :style='{"padding":"0 10px","boxShadow":"0 0 0px rgba(255,0,0,.5)","margin":"0 10px","borderColor":"#ccc","backgroundColor":"rgba(255, 144, 18, 1)","color":"rgba(255, 255, 255, 1)","borderRadius":"8px","borderWidth":"0","width":"25%","fontSize":"14px","borderStyle":"solid","height":"44px"}'
            type="reset" class="layui-btn layui-btn-primary">reset
          </button>
        </div>
      </div>
    </form>
  </div>
</div>

<script src="../../layui/layui.js"></script>
<script src="../../js/vue.js"></script>

<script src="../../js/config.js"></script>

<script src="../../modules/config.js"></script>

<script src="../../js/utils.js"></script>

<script src="../../js/validate.js"></script>
<!-- map  -->
<script type="text/javascript" src="../../js/jquery.js"></script>
<script type="text/javascript" src="http://webapi.amap.com/maps?v=1.3&key=ca04cee7ac952691aa67a131e6f0cee0"></script>
<script type="text/javascript" src="../../js/bootstrap.min.js"></script>
<script type="text/javascript" src="../../js/bootstrap.AMapPositionPicker.js"></script>

<script>
  var jquery = $;

  var vue = new Vue({
    el: '#app',
    data: {

      swiperList: [{
        img: '../../img/banner.jpg'
      }],
      dataList: [],
      ro: {
        kechengbianhao: false,
        kechengmingcheng: false,
        kechengleixing: false,
        tupian: false,
        shipin: false,
        xuexiziliao: false,
        kechengneirong: false,
        kechengliangdian: false,
        kechengjieshao: false,
        thumbsupnum: false,
        crazilynum: false,
      },
      detail: {
        kechengbianhao: genTradeNo(),
        kechengmingcheng: '',
        kechengleixing: '',
        tupian: '',
        shipin: '',
        xuexiziliao: '',
        kechengneirong: '',
        kechengliangdian: '',
        kechengjieshao: '',
        thumbsupnum: '',
        crazilynum: '',
      },
      kechengleixing: [],
      centerMenu: centerMenu
    },
    updated: function () {
      layui.form.render('select', 'myForm');
    },
    computed: {},
    methods: {
      jump(url) {
        jump(url)
      }
    }
  })


  layui.use(['layer', 'element', 'carousel', 'http', 'jquery', 'form', 'upload', 'laydate', 'tinymce'], function () {
    var layer = layui.layer;
    var element = layui.element;
    var carousel = layui.carousel;
    var http = layui.http;
    var jquery = layui.jquery;
    var form = layui.form;
    var upload = layui.upload;
    var laydate = layui.laydate;
    var tinymce = layui.tinymce


    http.request('config/list', 'get', {
      page: 1,
      limit: 5
    }, function (res) {
      if (res.data.list.length > 0) {
        var swiperItemHtml = '';
        for (let item of res.data.list) {
          if (item.name.indexOf('picture') >= 0 && item.value && item.value != "" && item.value != null) {
            swiperItemHtml +=
              '<div>' +
              '<img style="width: 100%;height: 100%;object-fit:cover;" class="swiper-item" src="' + item.value + '">' +
              '</div>';
          }
        }
        jquery('#swiper-item').html(swiperItemHtml);

        vue.$nextTick(() => {
          carousel.render({
            elem: '#swiper',
            width: '100%',
            height: '450px',
            arrow: 'hover',
            anim: 'default',
            autoplay: 'true',
            interval: '3000',
            indicator: 'inside'
          });

        })


      }
    });

    http.request(`option/coursety/course_type`, 'get', {}, (res) => {
      vue.kechengleixing = res.data
    });

    var tupianUpload = upload.render({

      elem: '#tupianUpload',

      url: http.baseurl + 'file/upload',

      headers: {
        Token: localStorage.getItem('Token')
      },

      accept: 'images',
      before: function () {

        var index = layer.load(1, {
          shade: [0.1, '#fff']
        });
      },

      done: function (res) {
        console.log(res);
        layer.closeAll();
        if (res.code == 0) {
          layer.msg("upload success", {
            time: 2000,
            icon: 6
          })
          var url = http.baseurl + 'upload/' + res.file;
          jquery('#tupian').val(url);
          jquery('#tupianImg').attr('src', url)
          vue.detail.tupian = url;
        } else {
          layer.msg(res.msg, {
            time: 2000,
            icon: 5
          })
        }
      },

      error: function () {
        layer.closeAll();
        layer.msg("request interface fail", {
          time: 2000,
          icon: 5
        })
      }
    });
    var shipinUpload = upload.render({

      elem: '#shipinUpload',

      url: http.baseurl + 'file/upload',

      headers: {
        Token: localStorage.getItem('Token')
      },

      accept: 'video',
      before: function () {

        var index = layer.load(1, {
          shade: [0.1, '#fff']
        });
      },

      done: function (res) {
        console.log(res);
        layer.closeAll();
        if (res.code == 0) {
          layer.msg("upload success", {
            time: 2000,
            icon: 6
          })
          var url = http.baseurl + 'upload/' + res.file;
          jquery('#shipin').val(url);
          vue.detail.shipin = url;
        } else {
          layer.msg(res.msg, {
            time: 2000,
            icon: 5
          })
        }
      },

      error: function () {
        layer.closeAll();
        layer.msg("request interface fail", {
          time: 2000,
          icon: 5
        })
      }
    });
    var xuexiziliaoUpload = upload.render({

      elem: '#xuexiziliaoUpload',

      url: http.baseurl + 'file/upload',

      headers: {
        Token: localStorage.getItem('Token')
      },

      accept: 'file',
      before: function () {

        var index = layer.load(1, {
          shade: [0.1, '#fff']
        });
      },

      done: function (res) {
        console.log(res);
        layer.closeAll();
        if (res.code == 0) {
          layer.msg("upload success", {
            time: 2000,
            icon: 6
          })
          var url = http.baseurl + 'upload/' + res.file;
          jquery('#xuexiziliao').val(url);
          vue.detail.xuexiziliao = url;
        } else {
          layer.msg(res.msg, {
            time: 2000,
            icon: 5
          })
        }
      },

      error: function () {
        layer.closeAll();
        layer.msg("request interface fail", {
          time: 2000,
          icon: 5
        })
      }
    });
    var edit = tinymce.render({
      elem: "#kechengjieshao",
      height: 600,
      images_upload_handler: function (blobInfo, succFun, failFun) {
        var xhr, formData;
        var file = blobInfo.blob();
        xhr = new XMLHttpRequest();
        xhr.withCredentials = false;
        xhr.open('POST', http.baseurl + 'file/upload');
        xhr.setRequestHeader("Token", localStorage.getItem('Token'));
        xhr.onload = function () {
          var json;
          if (xhr.status != 200) {
            failFun('HTTP Error: ' + xhr.status);
            return;
          }
          json = JSON.parse(xhr.responseText);
          if (!json || typeof json.file != 'string') {
            failFun('Invalid JSON: ' + xhr.responseText);
            return;
          }
          succFun(http.baseurl + 'upload/' + json.file);
        };
        formData = new FormData();
        formData.append('file', file, file.name);
        xhr.send(formData);
      }
    }, (opt) => {

    });


    let table = localStorage.getItem("userTable");
    http.request(`${table}/session`, 'get', {}, function (data) {


      data = data.data
      for (var key in data) {
      }
    });


    if (http.getParam('corss')) {
      var obj = JSON.parse(localStorage.getItem('crossObj'));
      for (var o in obj) {
        if (o == 'kechengbianhao') {
          vue.detail[o] = obj[o];
          vue.ro.kechengbianhao = true;
          continue;
        }
        if (o == 'kechengmingcheng') {
          vue.detail[o] = obj[o];
          vue.ro.kechengmingcheng = true;
          continue;
        }
        if (o == 'kechengleixing') {
          vue.detail[o] = obj[o];
          vue.ro.kechengleixing = true;
          continue;
        }
        if (o == 'tupian') {
          vue.detail[o] = obj[o];
          vue.ro.tupian = true;
          continue;
        }
        if (o == 'shipin') {
          vue.detail[o] = obj[o];
          vue.ro.shipin = true;
          continue;
        }
        if (o == 'xuexiziliao') {
          vue.detail[o] = obj[o];
          vue.ro.xuexiziliao = true;
          continue;
        }
        if (o == 'kechengneirong') {
          vue.detail[o] = obj[o];
          vue.ro.kechengneirong = true;
          continue;
        }
        if (o == 'kechengliangdian') {
          vue.detail[o] = obj[o];
          vue.ro.kechengliangdian = true;
          continue;
        }
        if (o == 'kechengjieshao') {
          vue.detail[o] = obj[o];
          vue.ro.kechengjieshao = true;
          continue;
        }
        if (o == 'thumbsupnum') {
          vue.detail[o] = obj[o];
          vue.ro.thumbsupnum = true;
          continue;
        }
        if (o == 'crazilynum') {
          vue.detail[o] = obj[o];
          vue.ro.crazilynum = true;
          continue;
        }
      }
    }


    form.on('submit(*)', function (data) {
      data = data.field;


      var kechengjieshao = tinymce.get('#kechengjieshao').getContent()
      data.kechengjieshao = kechengjieshao;
      if (!isIntNumer(data.thumbsupnum)) {
        layer.msg('please input integer', {
          time: 2000,
          icon: 5
        });
        return false
      }
      if (!isIntNumer(data.crazilynum)) {
        layer.msg('please input integer', {
          time: 2000,
          icon: 5
        });
        return false
      }


      http.requestJson('zaixianxuexi' + '/add', 'post', data, function (res) {
        layer.msg('Submitsuccess', {
          time: 2000,
          icon: 6
        }, function () {
          back();
        });
      });

      return false
    });

  });
</script>
</body>
</html>
